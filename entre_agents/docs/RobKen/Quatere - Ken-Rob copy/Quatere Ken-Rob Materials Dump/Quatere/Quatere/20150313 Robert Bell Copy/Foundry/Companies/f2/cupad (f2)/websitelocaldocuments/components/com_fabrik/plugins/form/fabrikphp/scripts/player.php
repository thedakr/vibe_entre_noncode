<?php//run when a player requests the mooses location//this is an example url he might use//http://moosehunt.mobi/index.php?option=com_fabrik&c=form&task=processForm&form_id=3&tableid=3&rowid=0&player_location___location=52.69979984974196,3.1640625&mobile=447970475122$db = JFactory::getDBO();//send sms to moose$sms = new sms();$url = "http://moosehunt.mobi/p-loc/details/3/3/" . $_POST['rowid'];$msg = "watch out! Hunters @ " . $_POST['player_location___location'] . " $url";$sms->message = $msg;$sms->process();//get the last moose location$db->setQuery("SELECT id, location FROM `moose_location` ORDER BY id DESC limit 1");$o = $db->loadObject();$mooseloc = $o->location;//set the moose location to requested so it appears on the map$db->setQuery("UPDATE `moose_location` SET requested = 1");$db->query();//store the current moose location in the moose sightings table$db->setQuery("INSERT INTO `moose_sightings` (`requested_moose_location`) VALUES ('$mooseloc')");$db->query();$id = $db->insertid();//send the moose sighting form url back to the user so they can take a photo or//$url = 'http://moosehunt.mobi/moose-sightings/form/4/4/'.$id; //form url$url = 'http://moosehunt.mobi/moose-sighting.php';//write a message claiming to have seen the moose.$msg = "View the moose's current location and upload media @ $url";$mobile = JRequest::getVar('mobile');if($mobile != ''){	$sms->_url = 'http://www.kapow.co.uk/scripts/sendsms.php?username=%s&password=%s&mobile=%s&sms=%s';	$sms->message = $msg;	$sms->mobile = $mobile;	$sms->process();}else{	//send back via itag	echo $msg;}//exit;class sms{ 		var $_url = 'http://www.kapow.co.uk/scripts/sendsms.php?username=%s&password=%s&mobile=%s&sms=%s'; 		var $username = 'slyman';		var $password = '93290Ht2JJ';		var $mobile = '07970475122';		var $message = null;	/**	* Constructor	*/	function __construct()	{			} 	 	/** 	 * process the plugin, called when form is submitted 	 * 	 * @param object $params 	 * @param object form 	 */ 	function process() 	{		$message = urlencode($this->message);		$this->_url = sprintf( $this->_url, $this->username, $this->password, $this->mobile, $message );		$this->_doRequest( 'GET', $this->_url, '' );			}		function _doRequest($method, $url, $vars)	{//		echo $url;exit;	    $ch = curl_init();	    curl_setopt($ch, CURLOPT_URL, $url);	    curl_setopt($ch, CURLOPT_HEADER, 1);	    curl_setopt($ch, CURLOPT_USERAGENT, $_SERVER['HTTP_USER_AGENT']);	    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);	    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);	    curl_setopt($ch, CURLOPT_COOKIEJAR, 'cookie.txt');	    curl_setopt($ch, CURLOPT_COOKIEFILE, 'cookie.txt');	    if ($method == 'POST') {	        curl_setopt($ch, CURLOPT_POST, 1);	        curl_setopt($ch, CURLOPT_POSTFIELDS, $vars);	    }	    $data = curl_exec($ch);	    	    if ($data) {	    } else {	        return curl_error($ch);	     }	     curl_close($ch);	}}?>