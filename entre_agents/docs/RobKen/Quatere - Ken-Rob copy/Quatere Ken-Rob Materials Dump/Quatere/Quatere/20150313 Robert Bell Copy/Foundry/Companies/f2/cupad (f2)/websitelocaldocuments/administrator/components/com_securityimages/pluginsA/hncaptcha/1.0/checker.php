<?php/** **************************************************************** * This file is part of SecurityImages for Joomla!. * * SecurityImages is free software: you can redistribute it and/or modify * it under the terms of the GNU General Public License as published by * the Free Software Foundation, either version 3 of the License, or * any later version. * Foobar is distributed in the hope that it will be useful, * but WITHOUT ANY WARRANTY; without even the implied warranty of * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the * GNU General Public License for more details. * * You should have received a copy of the GNU General Public License * along with Foobar.  If not, see <http://www.gnu.org/licenses/>. * * @package		SecurityImages * @copyright	Copyright (C) 2004 - 2008 Cdric Walter. All rights reserved. *******************************************************************/defined( '_JEXEC' ) or die( 'Restricted access' );jimport( 'joomla.utilities.log' );function icheckSecurityImage($enteredvalue){  include (JPATH_SITE.DS.'administrator'.DS.'components'.DS.'com_securityimages'.DS.'pluginsA'.DS.'hncaptcha'.DS.'1.0'.DS.'config.php');  require_once(JPATH_SITE .DS.'administrator'.DS.'components'.DS.'com_securityimages'.DS.'class'.DS.'logUtils.php');  $session = &JFactory::getSession();  $LogUtils = & new LogUtils();  $publicKey = $session->get('publicKey');  $hnkey = $session->get('hnkey');  $privateKey = $session->get('privateKey');  $privateofPublic = generate_private($publicKey, $hnkey);  if (!empty ($publicKey) && !empty ($enteredvalue))  {    $usertry = strtolower($enteredvalue);    $check = (generate_private($publicKey, $hnkey));    $res = ($usertry == $check) ? 'TRUE' : 'FALSE';    $result = $res == 'TRUE' ? TRUE : FALSE;    $LogUtils->writeCommentLog($result);    return $result;  }  $LogUtils->writeCommentLog(false);  return false;}/** * a copy, i am too lazy, but shall be done better, one note is that hncaptcha mixe presentation and logic, so quite difficult to solve it * (a monolithic big class) * */function generate_private($public, $hnkey){  include (JPATH_SITE.DS.'administrator'.DS.'components'.DS.'com_securityimages'.DS.'pluginsA'.DS.'hncaptcha'.DS.'1.0'.DS.'config.php');  $key = substr(md5($hnkey . $public), 16 - $chars / 2, $chars);  return $key;}?>