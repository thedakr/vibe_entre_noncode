<?php defined('_JEXEC') or die('Restricted access');/** ***************************************************************** This file is part of SecurityImages for Joomla!.** SecurityImages is free software: you can redistribute it and/or modify* it under the terms of the GNU General Public License as published by* any later version.* Foobar is distributed in the hope that it will be useful,*but WITHOUT ANY WARRANTY; without even the implied warranty of* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the* GNU General Public License for more details.** You should have received a copy of the GNU General Public License* along with Foobar.  If not, see <http://www.gnu.org/licenses/>.** @package		SecurityImages* @copyright	Copyright (C) 2004 - 2008 Cédric Walter. All rights reserved.********************************************************************/function siFileRename($oldfile,$newfile) {   if (!rename($oldfile,$newfile)) {      if (copy ($oldfile,$newfile)) {         unlink($oldfile);         return TRUE;      }      return FALSE;   }   return TRUE;}function com_install(){    $adminDir = dirname(__FILE__);?>	<table class="adminheading" cellpadding="4" cellspacing="0" border="0">      <tr>        <td><?php	$msgstart = "<h2><p style='color:red;'>There was a problem with your installation</p></h2>";	$msgend = "<h2>Please, consult the  forum <a target=\"_blank\" href=\"http://forums.waltercedric.com\">Forums</a>."			. "<br/>Thanks.</h2>";			/*	 * check path is writable	 */           if (!is_writable(JPATH_SITE."/plugins/system/")) {		$msgend = "<h2><p>Please:</p>" .				"<ul>" .				"	<li>Uninstall !SecurityImages</li>" .				"	<li>Modify the file permissions if needed</li>" .				"	<li>Reinstall</li>" .				"</ul>" .				"<br/>Thanks.</p>" .				"</h2>";        echo $msgstart . "<p>The directory ".JPATH_SITE."/plugins/system/\" is not writeable</p>". $msgend;        return false;    }    	$install_log = "<p>Installation of SecurityImages plugin</p>";		$archivename	= $adminDir."/plugin.zip";	$extractdir		= JPATH_SITE."/plugins/system/";	$result = JArchive::extract( $archivename, $extractdir);    if (!$result ) {    	echo $msgstart."<p style='color:red;'><b>error when unpacking plugin.zip from</b> $archivename<br /><b>TO</b> $extractdir</p>".$msgend;     	$msgstart = $msgend = "";     }                	$ordering = 0;	$published = 1;	$database = & JFactory::getDBO();    $database->setQuery(  "INSERT INTO `#__plugins` "    					. "        (`name`, `element`, `folder`, `access`, `ordering`, `published`, `iscore`, `client_id`, `checked_out`, `checked_out_time`, `params`) "    					. " VALUES ('System - securityimages', 'securityimages', 'system', 0, ".$ordering.", ".$published.", 0, 0, 0, '0000-00-00 00:00:00', 'reloadCaptchaCount=10');");	$result = $database->query();	if(!$result) {    	$install_log .= "plugins install error: " . $database->stderr() . "<br /><br />";     	echo $msgstart ."<p>". $install_log ."</p>". $msgend;    	return false;	}      //add new admin menu images    $database->setQuery("UPDATE #__components SET admin_menu_img='../components/com_comment/joscomment/images/logoicon.png' " .    					"  WHERE admin_menu_link='option=com_securityimages'");	$database->query();    $database->setQuery("UPDATE #__components SET admin_menu_img='../includes/js/ThemeOffice/edit.png' " .    					"  WHERE admin_menu_link='option=com_securityimages&task=comments'");	$database->query();    $database->setQuery("UPDATE #__components SET admin_menu_img='../includes/js/ThemeOffice/config.png' " .    					"  WHERE admin_menu_link='option=com_securityimages&task=general_settings'");	$database->query();    $database->setQuery("UPDATE #__components SET admin_menu_img='../includes/js/ThemeOffice/config.png' " .    					"  WHERE admin_menu_link='option=com_securityimages&task=settings'");	$database->query();	$database->setQuery("UPDATE #__components SET admin_menu_img='../includes/js/ThemeOffice/credits.png' " .						"   WHERE admin_menu_link='option=com_securityimages&task=about'");	$database->query();?>       </td>      </tr>      </table><?php 	require_once( dirname( __FILE__ ).DS.'admin.controller.php' );    $controller = new SecurityImagesAdminController();    $controller->execute('about');    $controller->redirect();}?>