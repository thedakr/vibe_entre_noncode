<?php/*** @package Joomla* @subpackage Fabrik* @copyright Copyright (C) 2005 Rob Clayburn. All rights reserved.* @license http://www.gnu.org/copyleft/gpl.html GNU/GPL, see LICENSE.php*/// Check to ensure this file is included in Joomla!defined('_JEXEC') or die();require_once( COM_FABRIK_FRONTEND.DS.'plugins'.DS.'element'.DS.'fabrikfileupload'.DS.'adaptor.php' );class filesystemstorage extends storageAdaptor{		/**	 * does a file exist	 * @param $filepath	 * @return unknown_type	 */	function exists( $filepath )	{		return JFile::exists( $filepath );	}		/**	 * does a folder exist	 * @param $folder	 * @return unknown_type	 */	function folderExists( $path )	{		return JFolder::exists( $path );	}		/**	 * create a folder	 * @param $path	 * @return unknown_type	 */	function createFolder( $path )	{		return JFolder::create( $path );	}		function clean( $path )	{		return JPath::clean( $path );	}		function delete( $filepath )	{		JFile::delete( $filepath );	}		function upload( $tmpFile, $filepath )	{		$this->uploadedFilePath = $filepath;		return JFile::upload( $tmpFile, $filepath );	}		function setPermissions( $filepath )	{		return JPath::setPermissions( $filepath );	}		function write( $file, $buffer )	{		JFile::write( $file, $buffer );	}		function getFileUrl( $file )	{		return str_replace( "\\", "/", COM_FABRIK_LIVESITE  . $file );	}		/**	 * get the thumbnail file for the file given	 *	 * @param string $file	 * @return string thumbnail	 */	function _getThumb( $file )	{		$params =& $this->getParams();		$w =& new FabrikWorker();		$ulDir = JPath::clean($params->get('ul_directory'));		$ulDir = str_replace("\\", "/", $ulDir);		//replace things like $my->id may barf on other stuff		$afile = str_replace(JURI::root(), '', $file);		$afile = ltrim($afile, "/");		$ulDir = ltrim($ulDir, "/");		$ulDirbits = explode('/', $ulDir);		$filebits = explode('/', $afile);		$match = array();		$replace = array();		for ($i=0; $i < count( $filebits ); $i++) {			if (array_key_exists( $i, $ulDirbits ) && $filebits[$i] != $ulDirbits[$i]) {				$match[] = $ulDirbits[$i];				$replace[] = $filebits[$i];			}		}		$ulDir = str_replace($match, $replace, $ulDir);		$thumbdir = str_replace($match, $replace, $params->get('thumb_dir'));		$ulDir = $w->parseMessageForPlaceHolder( $ulDir );		$thumbdir = $w->parseMessageForPlaceHolder( $thumbdir );		$file = str_replace( $ulDir, $thumbdir , $file );		$file = $w->parseMessageForPlaceHolder( $file );		$f = basename($file);		$dir = dirname($file);		$file = $dir . '/' . $params->get('thumb_prefix') .  $f;		//@todo apply JPath::clean to file name		return $file;	}}?>